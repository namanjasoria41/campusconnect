{% extends "base.html" %}
{% block title %}Chat - CampusConnect{% endblock %}
{% block content %}

<div class="row justify-content-center">
  <div class="col-lg-7">

    <div class="glass-card chat-card">

      <!-- Header -->
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="d-flex align-items-center gap-2">
          <div class="chat-avatar">
            {% if other.photo %}
              <img
                src="{{ url_for('static', filename='uploads/' ~ other.photo) }}"
                onerror="this.onerror=null;this.src='{{ url_for('static', filename='img/default-avatar.png') }}';"
                alt="{{ other.name }}">
            {% else %}
              <span>{{ other.name[0]|upper }}</span>
            {% endif %}
          </div>
          <div>
            <div class="fw-semibold small">{{ other.name }}</div>
            <div class="tiny text-muted">Chat</div>
          </div>
        </div>
      </div>

      <!-- Messages -->
      <div class="chat-messages mb-3" id="chat-scroll">
        {% for msg in messages %}
          {% set mine = (msg.sender_id == current_user.id) %}
          <div class="chat-message {% if mine %}mine{% else %}theirs{% endif %}">
            <div class="chat-bubble">
              <div class="chat-text">{{ msg.text }}</div>
              <div class="chat-meta tiny text-muted">
                {{ msg.created_at.strftime('%H:%M') }}
              </div>
            </div>
          </div>
        {% else %}
          <p class="text-muted small mb-0">No messages yet. Say hi ðŸ‘‹</p>
        {% endfor %}
      </div>

      <!-- Input -->
      <form method="post" class="chat-input-form">
        <div class="input-group">
          <textarea class="form-control" name="text" rows="1"
                    placeholder="Type your message..."
                    required></textarea>
          <button class="btn btn-primary" type="submit">
            <i class="bi bi-send-fill"></i>
          </button>
        </div>
      </form>

    </div>

  </div>
</div>

<script>
  // scroll to bottom
  const el = document.getElementById("chat-scroll");
  if (el) el.scrollTop = el.scrollHeight;
</script>

{% endblock %}

